<html>

  <head>
    <title>Elm In Space!</title>
    <script type="text/javascript" src="ElmInSpace.js"></script>
    <script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>
    <style>
      body {
        background-color: #000000;
        font-family: helvetica, arial, sans-serif;
        font-size: 14px;
      }
      #elminspace {
        width:  960px; height: 540px;
        border: 1px solid #111111;
        margin: auto; position: absolute;
        left: 0; right: 0; top: 0; bottom: 15%;
      }
    </style>
  </head>

  <body>
    <div id="elminspace" />
  </body>

  <script type="text/javascript">
    var elmDiv = document.getElementById('elminspace');
    // generate a random integer ...
    var rng = (Math.random() * 1000000000) | 0;
    console.log("Sending rng=" + rng + " to application");
    // ... and start Elm with it
    var elminspace =
      Elm.embed(Elm.ElmInSpace, elmDiv,
        { jsRNG : rng
        , receiveUsername : ""
        }
      );

    queryUsername = function(actuallyAsk) {
      if (actuallyAsk) {
        var username = null;
        while (username == null) {
          username = window.prompt("Yay, enter your name please...");
        }
        elminspace.ports.receiveUsername.send(username);
        elminspace.ports.requestUsername.unsubscribe(queryUsername);
      }
    }

    submitScore = function(dat) {
      if (dat.user != "") {
        var feuerbasis = new Firebase('https://elm-in-space.firebaseio.com/');
        console.log(dat);
        feuerbasis.push(dat);
        elminspace.ports.submitScore.unsubscribe(submitScore);
      }
    }

    elminspace.ports.requestUsername.subscribe(queryUsername);
    elminspace.ports.submitScore.subscribe(submitScore);

  </script>

</html>
